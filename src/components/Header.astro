---
// Header component with navigation and theme toggle
const currentPath = Astro.url.pathname;
---

<header
  class="border-b border-[rgb(var(--color-border))] sticky top-0 bg-[rgb(var(--color-bg))]/95 backdrop-blur-sm z-50"
>
  <nav class="max-w-5xl mx-auto px-4 py-4 flex items-center justify-between">
    <a
      href="/"
      class="text-lg font-bold hover:opacity-80 transition-opacity whitespace-nowrap font-mono flex items-center gap-1"
    >
      <span class="text-[rgb(var(--color-primary))]">➜</span>
      <span class="text-[rgb(var(--color-primary))]">~</span>
      <span>/yaayes.dev</span>
      <span
        class="inline-block w-2 h-4 bg-[rgb(var(--color-text))] ml-1 animate-blink"
      ></span>
    </a>

    <!-- Search Bar - Desktop only -->
    <div class="flex-1 max-w-md hidden lg:block mx-4">
      <div class="relative">
        <input
          type="text"
          id="header-search"
          placeholder="Search posts..."
          class="w-full px-4 py-2 pl-10 pr-10 rounded-lg border border-[rgb(var(--color-border))] bg-[rgb(var(--color-bg))] focus:outline-none focus:ring-2 focus:ring-[rgb(var(--color-primary))] text-sm"
        />
        <svg
          class="w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
        <button
          id="clear-search"
          class="hidden absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-[rgb(var(--color-primary))] transition-colors"
          aria-label="Clear search"
        >
          <svg
            class="w-4 h-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- Desktop Navigation -->
    <div class="hidden md:flex items-center gap-6">
      <a
        href="/"
        class:list={[
          "font-semibold hover:text-[rgb(var(--color-primary))] transition-colors whitespace-nowrap",
          currentPath === "/" && "text-[rgb(var(--color-primary))]",
        ]}
      >
        Home
      </a>
      <a
        href="/blog"
        class:list={[
          "font-semibold hover:text-[rgb(var(--color-primary))] transition-colors whitespace-nowrap",
          currentPath.startsWith("/blog") && "text-[rgb(var(--color-primary))]",
        ]}
      >
        Blog
      </a>
      <a
        href="/contact"
        class:list={[
          "font-semibold hover:text-[rgb(var(--color-primary))] transition-colors whitespace-nowrap",
          currentPath === "/contact" && "text-[rgb(var(--color-primary))]",
        ]}
      >
        Contact
      </a>

      <!-- Theme toggle dropdown -->
      <div class="relative">
        <button
          id="theme-toggle"
          class="p-2 rounded-lg hover:bg-[rgb(var(--color-border))] transition-colors text-[rgb(var(--color-text))]"
          aria-label="Theme options"
        >
          <!-- Sun icon (light) -->
          <svg
            id="icon-light"
            class="w-5 h-5 hidden"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
            ></path>
          </svg>
          <!-- Moon icon (dark) -->
          <svg
            id="icon-dark"
            class="w-5 h-5 hidden"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
            ></path>
          </svg>
          <!-- Monitor icon (system) -->
          <svg
            id="icon-system"
            class="w-5 h-5 hidden"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
            ></path>
          </svg>
        </button>

        <!-- Dropdown menu -->
        <div
          id="theme-menu"
          class="hidden absolute right-0 mt-2 w-32 rounded-lg border border-[rgb(var(--color-border))] bg-[rgb(var(--color-bg))] shadow-lg overflow-hidden z-50"
        >
          <button
            onclick="window.setTheme('light')"
            class="w-full px-4 py-2 text-left hover:bg-[rgb(var(--color-border))] transition-colors flex items-center gap-2"
          >
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
              ></path>
            </svg>
            Light
          </button>
          <button
            onclick="window.setTheme('dark')"
            class="w-full px-4 py-2 text-left hover:bg-[rgb(var(--color-border))] transition-colors flex items-center gap-2"
          >
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
              ></path>
            </svg>
            Dark
          </button>
          <button
            onclick="window.setTheme('system')"
            class="w-full px-4 py-2 text-left hover:bg-[rgb(var(--color-border))] transition-colors flex items-center gap-2"
          >
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
              ></path>
            </svg>
            System
          </button>
        </div>
      </div>
    </div>

    <!-- Mobile Menu Button and Theme Toggle -->
    <div class="flex md:hidden items-center gap-2">
      <!-- Theme toggle for mobile -->
      <div class="relative">
        <button
          id="theme-toggle-mobile"
          class="p-2 rounded-lg hover:bg-[rgb(var(--color-border))] transition-colors text-[rgb(var(--color-text))]"
          aria-label="Theme options"
        >
          <svg
            id="icon-light-mobile"
            class="w-5 h-5 hidden"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
            ></path>
          </svg>
          <svg
            id="icon-dark-mobile"
            class="w-5 h-5 hidden"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
            ></path>
          </svg>
          <svg
            id="icon-system-mobile"
            class="w-5 h-5 hidden"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
            ></path>
          </svg>
        </button>

        <!-- Mobile dropdown menu -->
        <div
          id="theme-menu-mobile"
          class="hidden absolute right-0 mt-2 w-32 rounded-lg border border-[rgb(var(--color-border))] bg-[rgb(var(--color-bg))] shadow-lg overflow-hidden z-50"
        >
          <button
            onclick="window.setTheme('light')"
            class="w-full px-4 py-2 text-left hover:bg-[rgb(var(--color-border))] transition-colors flex items-center gap-2"
          >
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
              ></path>
            </svg>
            Light
          </button>
          <button
            onclick="window.setTheme('dark')"
            class="w-full px-4 py-2 text-left hover:bg-[rgb(var(--color-border))] transition-colors flex items-center gap-2"
          >
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
              ></path>
            </svg>
            Dark
          </button>
          <button
            onclick="window.setTheme('system')"
            class="w-full px-4 py-2 text-left hover:bg-[rgb(var(--color-border))] transition-colors flex items-center gap-2"
          >
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
              ></path>
            </svg>
            System
          </button>
        </div>
      </div>

      <!-- Hamburger Button -->
      <button
        id="mobile-menu-toggle"
        class="p-2 rounded-lg hover:bg-[rgb(var(--color-border))] transition-colors"
        aria-label="Toggle menu"
      >
        <div class="hamburger">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </button>
    </div>
  </nav>
</header>

<!-- Mobile Menu (outside header to avoid stacking context issues) -->
<div
  id="mobile-menu"
  class="md:hidden fixed inset-0 top-0 bg-[rgb(var(--color-bg))] transform translate-x-full transition-transform duration-300 ease-in-out z-[60]"
>
  <div
    class="flex items-center justify-between px-4 py-4 border-b border-[rgb(var(--color-border))]"
  >
    <a
      href="/"
      class="text-lg font-bold hover:opacity-80 transition-opacity whitespace-nowrap font-mono flex items-center gap-1"
    >
      <span class="text-[rgb(var(--color-primary))]">➜</span>
      <span class="text-[rgb(var(--color-primary))]">~</span>
      <span>/yaayes.dev</span>
    </a>
    <button
      id="mobile-menu-close"
      class="p-2 rounded-lg hover:bg-[rgb(var(--color-border))] transition-colors"
      aria-label="Close menu"
    >
      <div class="hamburger active">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </button>
  </div>
  <div class="flex flex-col p-6 space-y-6">
    <!-- Mobile Search -->
    <div class="relative">
      <input
        type="text"
        id="mobile-search"
        placeholder="Search posts..."
        class="w-full px-4 py-2 pl-10 pr-10 rounded-lg border border-[rgb(var(--color-border))] bg-[rgb(var(--color-bg))] focus:outline-none focus:ring-2 focus:ring-[rgb(var(--color-primary))] text-sm"
      />
      <svg
        class="w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
      </svg>
    </div>

    <a
      href="/"
      class:list={[
        "text-2xl font-semibold hover:text-[rgb(var(--color-primary))] transition-colors py-2",
        currentPath === "/" && "text-[rgb(var(--color-primary))]",
      ]}
    >
      Home
    </a>
    <a
      href="/blog"
      class:list={[
        "text-2xl font-semibold hover:text-[rgb(var(--color-primary))] transition-colors py-2",
        currentPath.startsWith("/blog") && "text-[rgb(var(--color-primary))]",
      ]}
    >
      Blog
    </a>
    <a
      href="/contact"
      class:list={[
        "text-2xl font-semibold hover:text-[rgb(var(--color-primary))] transition-colors py-2",
        currentPath === "/contact" && "text-[rgb(var(--color-primary))]",
      ]}
    >
      Contact
    </a>
  </div>
</div>

<script>
  // Theme dropdown functionality
  document.addEventListener("DOMContentLoaded", () => {
    const themeToggle = document.getElementById("theme-toggle");
    const themeMenu = document.getElementById("theme-menu");
    const themeToggleMobile = document.getElementById("theme-toggle-mobile");
    const themeMenuMobile = document.getElementById("theme-menu-mobile");
    const iconLight = document.getElementById("icon-light");
    const iconDark = document.getElementById("icon-dark");
    const iconSystem = document.getElementById("icon-system");
    const iconLightMobile = document.getElementById("icon-light-mobile");
    const iconDarkMobile = document.getElementById("icon-dark-mobile");
    const iconSystemMobile = document.getElementById("icon-system-mobile");

    // Update icon based on current theme
    function updateThemeIcon() {
      const theme = localStorage.getItem("theme") || "system";

      // Desktop icons
      iconLight?.classList.add("hidden");
      iconDark?.classList.add("hidden");
      iconSystem?.classList.add("hidden");

      // Mobile icons
      iconLightMobile?.classList.add("hidden");
      iconDarkMobile?.classList.add("hidden");
      iconSystemMobile?.classList.add("hidden");

      if (theme === "light") {
        iconLight?.classList.remove("hidden");
        iconLightMobile?.classList.remove("hidden");
      } else if (theme === "dark") {
        iconDark?.classList.remove("hidden");
        iconDarkMobile?.classList.remove("hidden");
      } else {
        iconSystem?.classList.remove("hidden");
        iconSystemMobile?.classList.remove("hidden");
      }
    }

    // Toggle dropdown menu - Desktop
    themeToggle?.addEventListener("click", () => {
      themeMenu?.classList.toggle("hidden");
    });

    // Toggle dropdown menu - Mobile
    themeToggleMobile?.addEventListener("click", () => {
      themeMenuMobile?.classList.toggle("hidden");
    });

    // Close menu when clicking outside
    document.addEventListener("click", (e) => {
      if (
        !themeToggle?.contains(e.target as Node) &&
        !themeMenu?.contains(e.target as Node)
      ) {
        themeMenu?.classList.add("hidden");
      }
      if (
        !themeToggleMobile?.contains(e.target as Node) &&
        !themeMenuMobile?.contains(e.target as Node)
      ) {
        themeMenuMobile?.classList.add("hidden");
      }
    });

    // Update icon when theme changes
    window.addEventListener("themechange", () => {
      updateThemeIcon();
      themeMenu?.classList.add("hidden");
      themeMenuMobile?.classList.add("hidden");
    });

    // Initialize icon
    updateThemeIcon();

    // Mobile menu toggle
    const mobileMenuToggle = document.getElementById("mobile-menu-toggle");
    const mobileMenuClose = document.getElementById("mobile-menu-close");
    const mobileMenu = document.getElementById("mobile-menu");
    const hamburger = mobileMenuToggle?.querySelector(".hamburger");

    function openMobileMenu() {
      mobileMenu?.classList.remove("translate-x-full");
      hamburger?.classList.add("active");
      document.body.style.overflow = "hidden";
    }

    function closeMobileMenu() {
      mobileMenu?.classList.add("translate-x-full");
      hamburger?.classList.remove("active");
      document.body.style.overflow = "";
    }

    mobileMenuToggle?.addEventListener("click", () => {
      const isOpen = !mobileMenu?.classList.contains("translate-x-full");
      if (isOpen) {
        closeMobileMenu();
      } else {
        openMobileMenu();
      }
    });

    mobileMenuClose?.addEventListener("click", () => {
      closeMobileMenu();
    });

    // Close mobile menu when clicking on a link
    const mobileLinks = mobileMenu?.querySelectorAll("a");
    mobileLinks?.forEach((link) => {
      link.addEventListener("click", () => {
        closeMobileMenu();
      });
    });

    // Search functionality
    const headerSearch = document.getElementById("header-search");
    const mobileSearch = document.getElementById("mobile-search");
    const clearBtn = document.getElementById("clear-search");

    // Populate search from URL query
    const searchQuery = new URLSearchParams(window.location.search).get("q");
    if (searchQuery) {
      if (headerSearch) headerSearch.value = searchQuery;
      if (mobileSearch) mobileSearch.value = searchQuery;
      if (clearBtn) clearBtn.classList.remove("hidden");
    }

    const handleSearch = (value: string) => {
      if (value) {
        window.location.href = `/search?q=${encodeURIComponent(value)}`;
      }
    };

    // Desktop search
    if (headerSearch) {
      headerSearch.addEventListener("input", (e) => {
        const target = e.target as HTMLInputElement;
        if (clearBtn) {
          clearBtn.classList.toggle("hidden", !target.value);
        }
      });

      headerSearch.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          handleSearch((e.target as HTMLInputElement).value);
        }
      });
    }

    // Mobile search
    if (mobileSearch) {
      mobileSearch.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          handleSearch((e.target as HTMLInputElement).value);
        }
      });
    }

    // Clear button functionality
    if (clearBtn) {
      clearBtn.addEventListener("click", () => {
        if (headerSearch) {
          headerSearch.value = "";
          clearBtn.classList.add("hidden");
          if (
            window.location.pathname === "/search" &&
            window.location.search.includes("q=")
          ) {
            window.location.href = "/search";
          }
        }
      });
    }
  });
</script>

<style>
  @keyframes blink {
    0%,
    50% {
      opacity: 1;
    }
    51%,
    100% {
      opacity: 0;
    }
  }

  .animate-blink {
    animation: blink 1s step-end infinite;
  }

  /* Hamburger menu animation */
  .hamburger {
    width: 24px;
    height: 18px;
    position: relative;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .hamburger span {
    display: block;
    width: 100%;
    height: 2px;
    background-color: rgb(var(--color-text));
    transition: all 0.3s cubic-bezier(0.645, 0.045, 0.355, 1);
    transform-origin: center;
  }

  /* Hamburger to X animation */
  .hamburger.active span:nth-child(1) {
    transform: translateY(8px) rotate(45deg);
  }

  .hamburger.active span:nth-child(2) {
    opacity: 0;
    transform: translateX(-20px);
  }

  .hamburger.active span:nth-child(3) {
    transform: translateY(-8px) rotate(-45deg);
  }
</style>
