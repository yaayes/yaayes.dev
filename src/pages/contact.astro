---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
---

<Layout title="Contact" description="Get in touch with me">
  <div data-pagefind-ignore>
    <Header />

    <main class="max-w-2xl mx-auto px-4 py-12">
      <h1 class="text-4xl md:text-5xl font-bold mb-4">Get in Touch</h1>
      <p class="text-lg text-slate-600 dark:text-slate-400 mb-8">
        Have a question or want to work together? Drop me a message!
      </p>

      <form id="contact-form" class="card space-y-6">
        <div>
          <label for="name" class="block text-sm font-medium mb-2">
            Name *
          </label>
          <input
            type="text"
            id="name"
            name="name"
            required
            class="w-full px-4 py-2 rounded-lg border border-[rgb(var(--color-border))] bg-transparent focus:outline-none focus:ring-2 focus:ring-[rgb(var(--color-primary))]"
          />
        </div>

        <div>
          <label for="email" class="block text-sm font-medium mb-2">
            Email *
          </label>
          <input
            type="email"
            id="email"
            name="email"
            required
            class="w-full px-4 py-2 rounded-lg border border-[rgb(var(--color-border))] bg-transparent focus:outline-none focus:ring-2 focus:ring-[rgb(var(--color-primary))]"
          />
        </div>

        <div>
          <label for="message" class="block text-sm font-medium mb-2">
            Message *
          </label>
          <textarea
            id="message"
            name="message"
            rows="6"
            required
            class="w-full px-4 py-2 rounded-lg border border-[rgb(var(--color-border))] bg-transparent focus:outline-none focus:ring-2 focus:ring-[rgb(var(--color-primary))]"
          ></textarea>
        </div>

        <!-- Honeypot field (hidden from humans, visible to bots) -->
        <input
          type="text"
          name="website"
          id="website"
          style="position: absolute; left: -5000px;"
          tabindex="-1"
          autocomplete="off"
        />

        <button
          type="submit"
          class="btn w-full disabled:opacity-50 disabled:cursor-not-allowed"
          id="submit-btn"
        >
          Send Message
        </button>

        <div id="form-message" class="hidden text-center p-4 rounded-lg"></div>
      </form>
    </main>

    <script>
      const form = document.getElementById("contact-form") as HTMLFormElement;
      const submitBtn = document.getElementById(
        "submit-btn",
      ) as HTMLButtonElement;
      const formMessage = document.getElementById(
        "form-message",
      ) as HTMLDivElement;
      const WORKER_URL = "https://blog-worker.yaayes.dev";

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        // Disable submit button
        submitBtn.disabled = true;
        submitBtn.textContent = "Sending...";

        // Hide previous messages
        formMessage.classList.add("hidden");

        // Get form data
        const formData = new FormData(form);
        const data = {
          name: formData.get("name"),
          email: formData.get("email"),
          message: formData.get("message"),
          website: formData.get("website"), // Honeypot
        };

        try {
          const response = await fetch(`${WORKER_URL}/contact`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });

          const result = await response.json();

          if (response.ok) {
            // Success
            formMessage.textContent =
              "Message sent successfully! I'll get back to you soon.";
            formMessage.className =
              "text-center p-4 rounded-lg bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200";
            form.reset();
          } else {
            // Error from server
            formMessage.textContent =
              result.error || "Failed to send message. Please try again.";
            formMessage.className =
              "text-center p-4 rounded-lg bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200";
          }
        } catch (error) {
          // Network or other error
          formMessage.textContent = "Network error. Please try again later.";
          formMessage.className =
            "text-center p-4 rounded-lg bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200";
        } finally {
          // Re-enable submit button
          submitBtn.disabled = false;
          submitBtn.textContent = "Send Message";
          formMessage.classList.remove("hidden");
        }
      });
    </script>
  </div>
</Layout>
